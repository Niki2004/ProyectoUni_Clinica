@model ProyectoClinica.Models.Atencion_Cliente
@{
    ViewBag.Title = "Opinión";
}

<link href="~/CSS/VistaGeneral.css" rel="stylesheet" />
<link rel="stylesheet" href="~/CSS/Crear.css" />
<link href="~/CSS/Estrellas.css" rel="stylesheet" />

<body>
    <div class="container-fluid">
        <div id="notificationContainer" class="notification-container"></div>

        <div id="validationMessages" class="alert alert-danger" style="display: none;">
            <strong>Error:</strong> Por favor complete todos los campos obligatorios.
            <ul id="validationList"></ul>
        </div>

        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 sidebar">
                <div class="sidebar">
                    <div class="p-3 d-flex justify-content-center">
                        <a href="@Url.Action("VistaCita", "Cita")" style="text-decoration: none; display: block;">
                            <img src="~/Imagenes/Logo.png" alt="Centro Integral Santo Domingo Logo" class="img-fluid" style="max-width: 195px; height: auto;" />
                        </a>
                    </div>

                    <center><div class="nav-header">Plataforma</div></center>
                    <div class="nav flex-column">
                        <a href="@Url.Action("Index", "Cita")" class="nav-link">
                            <i class="fas fa-calendar-alt"></i> Cita
                        </a>
                        <a href="@Url.Action("AtencionCliente", "Cita")" class="nav-link">
                            <i class="fas fa-comments"></i> Comentarios
                        </a>
                    </div>
                    <hr />

                    <center><div class="nav-header">Información</div></center>
                    <div class="nav flex-column">
                        <a href="@Url.Action("Especialidad", "Cita")" class="nav-link">
                            <i class="fas fa-stethoscope"></i> Especialidad
                        </a>
                        <a href="@Url.Action("Contactanos", "Cita")" class="nav-link">
                            <i class="fas fa-phone-alt"></i> Contáctanos
                        </a>
                        <a href="@Url.Action("Ubicacion", "Cita")" class="nav-link">
                            <i class="fas fa-map-marker-alt"></i> Ubicación
                        </a>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 ms-auto button-container">
                <div class="container-form">
                    <h2 class="page-title">Comparte tu Experiencia</h2>

                    @using (Html.BeginForm("CrearAtencionCliente", "Cita", FormMethod.Post, new { id = "formComentario", onsubmit = "return validarFormulario()" }))
                    {
                        @Html.AntiForgeryToken()

                        <div class="form-section">
                            <legend>Información del Servicio</legend>
                            <div class="form-group">
                                @Html.LabelFor(model => model.Tipo_Servicio, "Tipo de Servicio", new { @class = "control-label col-md-4" })
                                <div class="col-md-8">
                                    @Html.DropDownListFor(model => model.Tipo_Servicio,
                                        new SelectList(new[]
                                        {
                                            "Consulta General",
                                            "Especialidad",
                                            "Laboratorio",
                                            "Emergencias",
                                            "Farmacia",
                                            "Atención al cliente",
                                            "Otros"
                                        }),
                                        "-- Seleccione un servicio --",
                                        new { @class = "form-control required" })
                                    @Html.ValidationMessageFor(model => model.Tipo_Servicio, "", new { @class = "text-danger" })
                                    <span class="field-validation-error" style="display: none;" id="error-Tipo_Servicio">Por favor seleccione un tipo de servicio</span>
                                </div>
                            </div>
                        </div>
                        <br />

                        <div class="form-section">
                            <legend>Tu Evaluación</legend>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.Salud_Evaluada, "¿Cómo calificarías tu salud tras la atención?", new { @class = "control-label" })
                                        <div class="star-rating">
                                            <input type="radio" id="star5" name="Salud_Evaluada" value="5" class="required" />
                                            <label for="star5" title="Excelente"></label>
                                            <input type="radio" id="star4" name="Salud_Evaluada" value="4" />
                                            <label for="star4" title="Muy buena"></label>
                                            <input type="radio" id="star3" name="Salud_Evaluada" value="3" />
                                            <label for="star3" title="Buena"></label>
                                            <input type="radio" id="star2" name="Salud_Evaluada" value="2" />
                                            <label for="star2" title="Regular"></label>
                                            <input type="radio" id="star1" name="Salud_Evaluada" value="1" />
                                            <label for="star1" title="Mala"></label>
                                        </div>
                                        <div class="rating-description" id="saludDescription"></div>
                                        @Html.ValidationMessageFor(model => model.Salud_Evaluada, "", new { @class = "text-danger" })
                                        <span class="field-validation-error" style="display: none;" id="error-Salud_Evaluada">Por favor califica tu salud tras la atención</span>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.Clasificacion_Problema, "Clasificación del Problema", new { @class = "control-label" })
                                        <div class="star-rating">
                                            <input type="radio" id="problema5" name="Clasificacion_Problema" value="5" class="required" />
                                            <label for="problema5"></label>
                                            <input type="radio" id="problema4" name="Clasificacion_Problema" value="4" />
                                            <label for="problema4"></label>
                                            <input type="radio" id="problema3" name="Clasificacion_Problema" value="3" />
                                            <label for="problema3"></label>
                                            <input type="radio" id="problema2" name="Clasificacion_Problema" value="2" />
                                            <label for="problema2"></label>
                                            <input type="radio" id="problema1" name="Clasificacion_Problema" value="1" />
                                            <label for="problema1"></label>
                                        </div>
                                        @Html.ValidationMessageFor(model => model.Clasificacion_Problema, "", new { @class = "text-danger" })
                                        <span class="field-validation-error" style="display: none;" id="error-Clasificacion_Problema">Por favor clasifica el problema</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <br />

                        <div class="form-section">
                            <legend>Detalles del Comentario</legend>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.Comentarios_Paciente, "Tu Comentario", new { @class = "control-label" })
                                        @Html.TextAreaFor(model => model.Comentarios_Paciente, new { @class = "form-control required", placeholder = "Comparte tu experiencia en detalle...", rows = "4" })
                                        @Html.ValidationMessageFor(model => model.Comentarios_Paciente, "", new { @class = "text-danger" })
                                        <span class="field-validation-error" style="display: none;" id="error-Comentarios_Paciente">Por favor comparte tu comentario</span>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.Prioridad_Mejora, "Prioridad de Mejora", new { @class = "control-label" })
                                        <div class="priority-selector">
                                            <div class="priority-card alta">
                                                <input type="radio" id="prioridadAlta" name="Prioridad_Mejora" value="Alta" class="required" />
                                                <label for="prioridadAlta">
                                                    <div class="icon-container">
                                                        <i class="fas fa-exclamation-circle"></i>
                                                    </div>
                                                    <div class="priority-text">Alta</div>
                                                </label>
                                            </div>
                                            <div class="priority-card media">
                                                <input type="radio" id="prioridadMedia" name="Prioridad_Mejora" value="Media" />
                                                <label for="prioridadMedia">
                                                    <div class="icon-container">
                                                        <i class="fas fa-clipboard-list"></i>
                                                    </div>
                                                    <div class="priority-text">Media</div>
                                                </label>
                                            </div>
                                            <div class="priority-card baja">
                                                <input type="radio" id="prioridadBaja" name="Prioridad_Mejora" value="Baja" />
                                                <label for="prioridadBaja">
                                                    <div class="icon-container">
                                                        <i class="fas fa-check-circle"></i>
                                                    </div>
                                                    <div class="priority-text">Baja</div>
                                                </label>
                                            </div>
                                        </div>
                                        @Html.ValidationMessageFor(model => model.Prioridad_Mejora, "", new { @class = "text-danger" })
                                        <span class="field-validation-error" style="display: none;" id="error-Prioridad_Mejora">Por favor selecciona la prioridad de mejora</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        @Html.HiddenFor(model => model.Fechas_Comentario)

                        <div class="form-group text-center">
                            <input type="submit" value="Enviar" class="btn-primary" />

                            <a href="@Url.Action("AtencionCliente", "Cita")" class="btn-secondary">Regresar</a>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var today = new Date();
            var dd = String(today.getDate()).padStart(2, '0');
            var mm = String(today.getMonth() + 1).padStart(2, '0');
            var yyyy = today.getFullYear();

            today = yyyy + '-' + mm + '-' + dd;
            document.querySelector('input[name="Fechas_Comentario"]').value = today;

            $('.required').on('blur', function () {
                var fieldId = $(this).attr('id');

                if ($(this).is('select')) {
                    if ($(this).val() === "" || $(this).val() === null || $(this).val() === "-- Seleccione un servicio --") {
                        $('#error-' + fieldId).show();
                    } else {
                        $('#error-' + fieldId).hide();
                    }
                } else if ($(this).is(':radio')) {
                    var name = $(this).attr('name');
                    if (!$('input[name="' + name + '"]:checked').val()) {
                        $('#error-' + name).show();
                    } else {
                        $('#error-' + name).hide();
                    }
                } else {
                    if ($(this).val() === "") {
                        $('#error-' + fieldId).show();
                    } else {
                        $('#error-' + fieldId).hide();
                    }
                }
            });
        });

        function validarFormulario() {
            var isValid = true;
            var mensajesError = [];

            $('.field-validation-error').hide();
            $('#validationMessages').hide();
            $('#validationList').empty();

            $('.required').each(function () {
                var fieldId = $(this).attr('id');
                var fieldName = $(this).attr('name');
                var fieldLabel = $('label[for="' + fieldId + '"]').text() || $('label[for="' + fieldName + '"]').text() || fieldId || fieldName;

                if ($(this).is('select') && ($(this).val() === "" || $(this).val() === null || $(this).val() === "-- Seleccione un servicio --")) {
                    isValid = false;
                    $('#error-' + fieldId).show();
                    mensajesError.push('Debe seleccionar un valor para ' + fieldLabel);
                }
                else if ($(this).is(':radio')) {
                    var name = $(this).attr('name');
                    if (!$('input[name="' + name + '"]:checked').val() && !mensajesError.includes('Debe seleccionar un valor para ' + fieldLabel)) {
                        isValid = false;
                        $('#error-' + name).show();
                        mensajesError.push('Debe seleccionar un valor para ' + fieldLabel);
                    }
                }
                else if ($(this).val() === "") {
                    isValid = false;
                    $('#error-' + fieldId).show();
                    mensajesError.push('El campo ' + fieldLabel + ' es obligatorio');
                }
            });

            if (!isValid) {
                mensajesError.forEach(function (mensaje) {
                    $('#validationList').append('<li>' + mensaje + '</li>');
                });
                $('#validationMessages').show();

                $('html, body').animate({
                    scrollTop: $('#validationMessages').offset().top - 100
                }, 200);
            }

            return isValid;
        }
    </script>
</body>