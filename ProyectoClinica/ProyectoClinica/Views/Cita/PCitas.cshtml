@model IEnumerable<ProyectoClinica.Models.Cita>

@{
    ViewBag.Title = "Citas";
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Centro Integral Santo Domingo</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <link href="~/CSS/VistaGeneral.css" rel="stylesheet" />



</head>
<body>
    <div class="container-fluid">

        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 sidebar">
                <div class="sidebar">
                    <div class="p-3 d-flex justify-content-center">
                        <img src="~/Imagenes/Logo.png" alt="Centro Integral Santo Domingo Logo" class="img-fluid" style="max-width: 195px; height: auto;" />
                    </div>

                    <center><div class="nav-header">Plataforma</div></center>
                    <div class="nav-item">
                        <a class="nav-link">
                            <div>
                                Navegación
                            </div>

                        </a>
                        <ul class="submenu">
                            <a href="@Url.Action(" ", "Punto de Venta")" class="nav-link">
                                <i class="fas fa-cash-register"></i> Punto de Venta
                            </a>
                            <br />
                            <a href="@Url.Action("Index", "Inventario")" class="nav-link">
                                <i class="fas fa-boxes"></i> Inventario
                            </a>
                            <br />
                            <a href="@Url.Action("VistaCON", "Contabilidad")" class="nav-link">
                                <i class="fas fa-calculator"></i> Contabilidad
                            </a>
                            <br />
                            <a href="@Url.Action("VistaAdmRep", "Reporte")" class="nav-link">
                                <i class="fas fa-chart-line"></i> Reportes
                            </a>
                        </ul>
                    </div>

                    <hr />

                    <div class="nav-item">
                        <a class="nav-link">
                            <div>
                                Administración
                            </div>

                        </a>
                        <ul class="submenu">
                            <a href="@Url.Action("Administrativo", "Administrativos")" class="nav-link">
                                <i class="fas fa-user-tie"></i> Administrativo
                            </a>
                            <br />
                            <a href="@Url.Action("Empleados", "Empleados")" class="nav-link">
                                <i class="fas fa-users"></i> Empleados
                            </a>
                            <br />
                            <a href="@Url.Action("Expedientes", "Expedientes")" class="nav-link">
                                <i class="fas fa-folder-open"></i> Expedientes
                            </a>
                            <br />
                            <a class="nav-link">
                                <i class="fas fa-calendar-check"></i> Citas
                            </a>
                        </ul>
                    </div>
                </div>
            </div>


            <!-- Main Content -->
            <div class="button-container">

                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <a href="@Url.Action("VistaCAdmin", "Cita")" style="text-decoration: none; color: #000000; font-size: 18px; display: flex; align-items: center;">
                        <i class="fas fa-home" style="margin-right: 5px;"></i>
                        <h4 style="margin: 0; font-weight: bold; color: #333;">Programación de Citas</h4>
                    </a>
                </div>

                <div style="text-align: left; margin-bottom: 5px;">
                    <span style="font-size: 14px; color: #555;">
                        Obtén una visión completa de la información clínica, administrativa y financiera de tu clínica de salud
                    </span>
                </div>
                <br />

                <h2 class="text-center">Calendario</h2>

                <br />

                <!-- Formato Calendario -->
                <div id="calendar"></div>
                <br />

                <!-- Detalles de la Cita Seleccionada -->
                <div id="cita-detalle" class="card" style="display:none; margin-top: 20px; padding: 15px; border: 1px solid #ccc; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <center><h4 class="card-title" style="color: #333; border-bottom: 1px solid #eee; padding-bottom: 10px;">Detalles de la Cita</h4></center>
                    <div class="card-body">
                        <p><strong style="color: #666;">Médico:</strong> <span id="doctor-cita"></span></p>
                        <p><strong style="color: #666;">Fecha:</strong> <span id="fecha-cita"></span></p>
                        <p><strong style="color: #666;">Hora:</strong> <span id="hora-cita"></span></p>

                        </p>
                    </div>
                </div>

                @section Scripts {
                    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.js"></script>
                    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.css" />

                    <script>
document.addEventListener('DOMContentLoaded', function () {
    var calendarEl = document.getElementById('calendar');
    var selectedEvent = null; // Variable para almacenar el evento seleccionado

    var calendar = new FullCalendar.Calendar(calendarEl, {
        locale: 'es', // Establece el idioma a español
        initialView: 'dayGridMonth',
        events: '/Cita/GetCita', // Obtiene las citas desde el controlador
        headerToolbar: {
            left: 'prev,next today agendarButton',
            center: 'title',
            right: 'dayGridMonth' // Solo muestra la vista mensual
        },
        buttonText: {
            today: 'Hoy',
            month: 'Mes',
            prev: 'Anterior',
            next: 'Siguiente'
        },
        customButtons: {
            agendarButton: {
                text: 'Agendar Cita',
                click: function () {
                    window.location.href = '@Url.Action("CrearADM", "Cita")'; // Redirige al formulario de creación
                }
            }
        },
        eventColor: 'blue',
        eventTimeFormat: {
            hour: '2-digit',
            minute: '2-digit',
            meridiem: false
        },
        dateClick: function (info) {
            if (confirm(`¿Deseas agendar una cita para el día ${info.dateStr}?`)) {
                window.location.href = '@Url.Action("CrearADM", "Cita")?fecha=' + info.dateStr;
            }
        },
        eventClick: function (info) {
            selectedEvent = info.event;

            // Mostrar el panel de detalles
            document.getElementById('cita-detalle').style.display = 'block';

            // Obtener y formatear la fecha y hora
            const fecha = info.event.start;
            const fechaFormateada = fecha.toLocaleDateString('es-ES', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            const horaFormateada = fecha.toLocaleTimeString('es-ES', {
                hour: '2-digit',
                minute: '2-digit'
            });

            // Actualizar los campos con la información
            document.getElementById('doctor-cita').textContent = info.event.title;
            document.getElementById('fecha-cita').textContent = fechaFormateada;
            document.getElementById('hora-cita').textContent = horaFormateada;
        }
    });

    calendar.render();
});
                    </script>
                }
            </div>

            <script src="~/lib/jquery/dist/jquery.min.js"></script>
            <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
            <script>
                // Toggle submenu functionality
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', function () {
                        // Close all other open submenus
                        document.querySelectorAll('.submenu').forEach(submenu => {
                            if (submenu !== this.nextElementSibling) {
                                submenu.classList.remove('active');
                                this.classList.remove('active');
                            }
                        });

                        // Toggle the clicked submenu
                        const submenu = this.nextElementSibling;
                        submenu.classList.toggle('active');
                        this.classList.toggle('active');
                    });
                });
            </script>
</body>
