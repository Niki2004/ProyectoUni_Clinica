@{
    ViewBag.Title = "Administrativo";
}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css">
<link href="~/CSS/VistaGeneral.css" rel="stylesheet" />
<link href="~/CSS/VistaAsignacionRolesTemporales.css" rel="stylesheet" />
<link href="~/CSS/AdministartivoResponsive.css" rel="stylesheet" />


</head>
<body>
    <div class="container-fluid">
        <!-- Contenedor de notificaciones -->
        <div id="notificationContainer" class="notification-container"></div>

        <!-- Estilos para notificaciones -->
        <style>
            .notification-container {
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 1050;
                width: 350px;
            }

            .notification {
                background-color: white;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                margin-bottom: 10px;
                overflow: hidden;
                animation: slideIn 0.3s ease-out forwards;
            }

            .notification-header {
                padding: 10px 15px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                border-bottom: 1px solid #f0f0f0;
            }

            .notification-body {
                padding: 15px;
            }

            .notification-title {
                margin: 0;
                font-weight: bold;
                display: flex;
                align-items: center;
            }

            .notification-title i {
                margin-right: 8px;
            }

            .notification-close {
                background: none;
                border: none;
                font-size: 16px;
                cursor: pointer;
            }

            .notification-danger {
                border-left: 4px solid #dc3545;
            }

            .notification-warning {
                border-left: 4px solid #ffc107;
            }

            .notification-success {
                border-left: 4px solid #28a745;
            }

            .notification-list {
                max-height: 150px;
                overflow-y: auto;
                margin: 0;
                padding-left: 20px;
            }

            .notification-item {
                margin-bottom: 5px;
            }

            
        </style>

        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 sidebar">
                <div class="sidebar">
                    <div class="p-3 d-flex justify-content-center">
                        <img src="~/Imagenes/Logo.png" alt="Centro Integral Santo Domingo Logo" class="img-fluid" style="max-width: 195px; height: auto;" />
                    </div>

                    <center><div class="nav-header">Plataforma</div></center>
                    <div class="nav-item">
                        <a class="nav-link">
                            <div>
                                Navegación
                            </div>

                        </a>
                        <ul class="submenu">

                            <br />
                            <a href="@Url.Action("Index", "Inventario")" class="nav-link">
                                <i class="fas fa-boxes"></i> Inventario
                            </a>
                            <br />
                            <a href="@Url.Action("VistaCON", "Contabilidad")" class="nav-link">
                                <i class="fas fa-calculator"></i> Contabilidad
                            </a>
                            <br />
                            <a href="@Url.Action("VistaAdmRep", "Reporte")" class="nav-link">
                                <i class="fas fa-chart-line"></i> Reportes
                            </a>
                        </ul>
                    </div>

                    <hr />

                    <div class="nav-item">
                        <a class="nav-link">
                            <div>
                                Administración
                            </div>

                        </a>
                        <ul class="submenu">
                            <a href="@Url.Action("Administrativo", "Administrativos")" class="nav-link">
                                <i class="fas fa-user-tie"></i> Administrativo
                            </a>
                            <br />
                            <a href="@Url.Action("Empleados", "Empleados")" class="nav-link">
                                <i class="fas fa-users"></i> Empleados
                            </a>
                            <br />
                            <a href="@Url.Action("Expedientes", "Expedientes")" class="nav-link">
                                <i class="fas fa-folder-open"></i> Expedientes
                            </a>
                            <br />
                            <a href="@Url.Action("VistaCAdmin", "Cita")" class="nav-link">
                                <i class="fas fa-calendar-check"></i> Citas
                            </a>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="button-container">
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <a href="@Url.Action("VistaAdmin", "Empleados")" style="text-decoration: none; color: #000000; font-size: 18px; display: flex; align-items: center;">
                        <i class="fas fa-home" style="margin-right: 5px;"></i>
                        <h4 style="margin: 0; font-weight: bold; color: #333;">Módulo Administrativo</h4>
                    </a>
                </div>

                <div style="text-align: left; margin-bottom: 5px;">
                    <span style="font-size: 14px; color: #555;">
                        Obtén una visión completa de la información clínica, administrativa y financiera de tu clínica de salud.
                    </span>
                </div>
                <br />

                @if (TempData["SuccessMessage"] != null)
                {
                    <div class="alert alert-success" role="alert">
                        @TempData["SuccessMessage"]
                    </div>
                }

                @if (ViewBag.TienePermisos || ViewBag.EsAdministrador)
                {
                    <div class="gallery-container">
                        <div class="dashboard-cards">
                            <!-- Tarjeta 1 -->
                            <div class="simple-card">
                                <div class="card-number">1</div>
                                <div class="card-header">
                                    <h3 class="card-title">Registro de Usuarios</h3>
                                    <span class="card-subtitle"></span>
                                </div>
                                <div class="card-body">
                                    <p>Creación de nuevas cuentas de usuario</p>
                                </div>
                                <a href="@Url.Action("Create", "Administrativos")" class="detail-btn">
                                    <i class="fas fa-arrow-right"></i> Ingresar
                                </a>
                            </div>

                            <!-- Tarjeta 2 -->
                            <div class="simple-card">
                                <div class="card-number">2</div>
                                <div class="card-header">
                                    <h3 class="card-title">Asignación de Roles</h3>
                                    <span class="card-subtitle"></span>
                                </div>
                                <div class="card-body">
                                    <p>Gestión de roles y permisos de usuarios</p>
                                </div>
                                <a href="@Url.Action("Index", "AsignacionRolesTemporales")" class="detail-btn">
                                    <i class="fas fa-arrow-right"></i> Ingresar
                                </a>
                            </div>

                            <!-- Tarjeta 3 -->
                            <div class="simple-card">
                                <div class="card-number">3</div>
                                <div class="card-header">
                                    <h3 class="card-title">Editar Usuarios</h3>
                                    <span class="card-subtitle"></span>
                                </div>
                                <div class="card-body">
                                    <p>Modificación de información de usuarios</p>
                                </div>
                                <a href="@Url.Action("VistaADM", "Administrativos")" class="detail-btn">
                                    <i class="fas fa-arrow-right"></i> Ingresar
                                </a>
                            </div>

                            <!-- Tarjeta 4 -->
                            <div class="simple-card">
                                <div class="card-number">4</div>
                                <div class="card-header">
                                    <h3 class="card-title">Deshabilitar Usuarios</h3>
                                    <span class="card-subtitle"></span>
                                </div>
                                <div class="card-body">
                                    <p>Desactivación de cuentas de usuario</p>
                                </div>
                                <a href="@Url.Action("VistaEliminar", "Administrativos")" class="detail-btn">
                                    <i class="fas fa-arrow-right"></i> Ingresar
                                </a>
                            </div>

                            <!-- Tarjeta 5 -->
                            <div class="simple-card">
                                <div class="card-number">5</div>
                                <div class="card-header">
                                    <h3 class="card-title">Buscar Usuarios</h3>
                                    <span class="card-subtitle"></span>
                                </div>
                                <div class="card-body">
                                    <p>Búsqueda en la base de datos de usuarios</p>
                                </div>
                                <a href="@Url.Action("Buscar", "Administrativos")" class="detail-btn">
                                    <i class="fas fa-arrow-right"></i> Ingresar
                                </a>
                            </div>

                            <!-- Tarjeta 6 -->
                            <div class="simple-card">
                                <div class="card-number">6</div>
                                <div class="card-header">
                                    <h3 class="card-title">Auditoría Administrativa</h3>
                                    <span class="card-subtitle"></span>
                                </div>
                                <div class="card-body">
                                    <p>Revisión de cambios y acciones realizadas</p>
                                </div>
                                <a href="@Url.Action("VistaAuditoría", "Administrativos")" class="detail-btn">
                                    <i class="fas fa-arrow-right"></i> Ingresar
                                </a>
                            </div>

                            <!-- Tarjeta 7 -->
                            <div class="simple-card">
                                <div class="card-number">7</div>
                                <div class="card-header">
                                    <h3 class="card-title">Ver Pagos</h3>
                                    <span class="card-subtitle"></span>
                                </div>
                                <div class="card-body">
                                    <p>Visualización de historial de pagos realizados</p>
                                </div>
                                <a href="@Url.Action("VerPagos", "Factura")" class="detail-btn">
                                    <i class="fas fa-arrow-right"></i> Ingresar
                                </a>
                            </div>

                            <!-- Tarjeta 8 -->
                            <div class="simple-card">
                                <div class="card-number">8</div>
                                <div class="card-header">
                                    <h3 class="card-title">Historial de Actividades</h3>
                                    <span class="card-subtitle"></span>
                                </div>
                                <div class="card-body">
                                    <p>Revisión del registro de actividades del sistema</p>
                                </div>
                                <a href="@Url.Action("ListarHistorial", "Administrativos")" class="detail-btn">
                                    <i class="fas fa-arrow-right"></i> Ingresar
                                </a>
                            </div>
                        </div>

                    </div>

                }
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Toggle submenu functionality
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function () {
                // Close all other open submenus
                document.querySelectorAll('.submenu').forEach(submenu => {
                    if (submenu !== this.nextElementSibling) {
                        submenu.classList.remove('active');
                        this.classList.remove('active');
                    }
                });

                // Toggle the clicked submenu
                const submenu = this.nextElementSibling;
                submenu.classList.toggle('active');
                this.classList.toggle('active');
            });
        });

        // Mostrar notificación inmediatamente al cargar la página
        window.onload = function() {
            @if (ViewBag.EsAdministrador)
            {
                <text>
                var notification = document.createElement('div');
                notification.className = 'notification notification-success';
                
                var header = document.createElement('div');
                header.className = 'notification-header';
                
                var title = document.createElement('h5');
                title.className = 'notification-title';
                
                var icon = document.createElement('i');
                icon.className = 'fas fa-check-circle';
                title.appendChild(icon);
                title.appendChild(document.createTextNode('Acceso de Administrador'));
                
                var closeBtn = document.createElement('button');
                closeBtn.className = 'notification-close';
                closeBtn.innerHTML = '&times;';
                closeBtn.onclick = function() { notification.remove(); };
                
                header.appendChild(title);
                header.appendChild(closeBtn);
                
                var body = document.createElement('div');
                body.className = 'notification-body';
                
                var list = document.createElement('ul');
                list.className = 'notification-list';
                
                var items = [
                    'Estado: @ViewBag.Estado',
                    'Departamento: @Html.Raw(HttpUtility.HtmlDecode(ViewBag.Departamento))',
                    'Tiene acceso completo a todos los módulos administrativos del sistema.'
                ];
                
                items.forEach(function(item) {
                    var li = document.createElement('li');
                    li.className = 'notification-item';
                    li.textContent = item;
                    list.appendChild(li);
                });
                
                body.appendChild(list);
                
                notification.appendChild(header);
                notification.appendChild(body);
                
                document.getElementById('notificationContainer').appendChild(notification);
                
                setTimeout(function() {
                    notification.remove();
                }, 10000);
                </text>
            }
            else if (ViewBag.TienePermisos)
            {
                <text>
                var notification = document.createElement('div');
                notification.className = 'notification notification-warning';
                
                var header = document.createElement('div');
                header.className = 'notification-header';
                
                var title = document.createElement('h5');
                title.className = 'notification-title';
                
                var icon = document.createElement('i');
                icon.className = 'fas fa-clock';
                title.appendChild(icon);
                title.appendChild(document.createTextNode('Usuario con Permisos'));
                
                var closeBtn = document.createElement('button');
                closeBtn.className = 'notification-close';
                closeBtn.innerHTML = '&times;';
                closeBtn.onclick = function() { notification.remove(); };
                
                header.appendChild(title);
                header.appendChild(closeBtn);
                
                var body = document.createElement('div');
                body.className = 'notification-body';
                
                var list = document.createElement('ul');
                list.className = 'notification-list';
                
                var items = [
                    'Estado: @ViewBag.Estado',
                    'Departamento Asignado: @Html.Raw(HttpUtility.HtmlDecode(ViewBag.Departamento))',
                    'Tiene acceso a los módulos administrativos según su asignación temporal en el sistema.'
                ];
                
                items.forEach(function(item) {
                    var li = document.createElement('li');
                    li.className = 'notification-item';
                    li.textContent = item;
                    list.appendChild(li);
                });
                
                body.appendChild(list);
                
                notification.appendChild(header);
                notification.appendChild(body);
                
                document.getElementById('notificationContainer').appendChild(notification);
                
                setTimeout(function() {
                    notification.remove();
                }, 10000);
                </text>
            }
            else
            {
                <text>
                var notification = document.createElement('div');
                notification.className = 'notification notification-danger';
                
                var header = document.createElement('div');
                header.className = 'notification-header';
                
                var title = document.createElement('h5');
                title.className = 'notification-title';
                
                var icon = document.createElement('i');
                icon.className = 'fas fa-exclamation-triangle';
                title.appendChild(icon);
                title.appendChild(document.createTextNode('Acceso Restringido'));
                
                var closeBtn = document.createElement('button');
                closeBtn.className = 'notification-close';
                closeBtn.innerHTML = '&times;';
                closeBtn.onclick = function() { notification.remove(); };
                
                header.appendChild(title);
                header.appendChild(closeBtn);
                
                var body = document.createElement('div');
                body.className = 'notification-body';
                
                var list = document.createElement('ul');
                list.className = 'notification-list';
                
                var items = [
                    'No tiene permisos activos para acceder a los módulos administrativos.',
                    'Por favor, contacte al administrador para obtener los permisos necesarios para utilizar esta sección.'
                ];
                
                items.forEach(function(item) {
                    var li = document.createElement('li');
                    li.className = 'notification-item';
                    li.textContent = item;
                    list.appendChild(li);
                });
                
                body.appendChild(list);
                
                notification.appendChild(header);
                notification.appendChild(body);
                
                document.getElementById('notificationContainer').appendChild(notification);
                
                setTimeout(function() {
                    notification.remove();
                }, 10000);
                </text>
            }
        };

        document.addEventListener('DOMContentLoaded', function () {
            // 1. Crear botón hamburguesa
            const menuBtn = document.createElement('button');
            menuBtn.className = 'menu-toggle';
            menuBtn.innerHTML = '<i class="fas fa-bars"></i>';
            menuBtn.style.display = 'none'; // Inicialmente oculto

            // 2. Crear overlay para cuando sidebar está abierto
            const overlay = document.createElement('div');
            overlay.className = 'sidebar-overlay';

            // 3. Agregar elementos al DOM
            document.body.appendChild(menuBtn);
            document.body.appendChild(overlay);

            // 4. Funcionalidad del botón
            menuBtn.addEventListener('click', function () {
                const sidebar = document.querySelector('.sidebar');
                sidebar.classList.toggle('visible');
                overlay.classList.toggle('visible');
            });

            // 5. Cerrar sidebar al hacer clic en overlay
            overlay.addEventListener('click', function () {
                document.querySelector('.sidebar').classList.remove('visible');
                overlay.classList.remove('visible');
            });

            // 6. Manejar responsive
            function handleResponsive() {
                // Mostrar u ocultar botón según tamaño
                menuBtn.style.display = window.innerWidth <= 992 ? 'block' : 'none';

                // En pantallas grandes, reset sidebar
                if (window.innerWidth > 992) {
                    document.querySelector('.sidebar').classList.remove('visible');
                    overlay.classList.remove('visible');
                }

                // Corregir margen de tarjeta de información
                const infoCard = document.querySelector('.simple-card[style*="margin-left: 305px"]');
                if (infoCard) {
                    if (window.innerWidth <= 992) {
                        // Sobrescribir estilo inline
                        infoCard.style.marginLeft = '0';
                        infoCard.style.width = '100%';
                        infoCard.style.maxWidth = '100%';
                    } else {
                        // Restaurar estilo original
                        infoCard.style.marginLeft = '305px';
                        infoCard.style.width = '95%';
                        infoCard.style.maxWidth = '1020px';
                    }
                }
            }

            // 7. Inicializar y configurar event listener
            handleResponsive();
            window.addEventListener('resize', handleResponsive);
        });
    </script>
</body>