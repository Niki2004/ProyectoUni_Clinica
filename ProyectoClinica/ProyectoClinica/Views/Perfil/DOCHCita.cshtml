@model IEnumerable<ProyectoClinica.Models.Cita>

@{
    ViewBag.Title = "Medico";
}

<!-- Cargar Bootstrap -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- Estilos adicionales para la tabla y card -->
<style>
    .table th, .table td {
        text-align: center;
        padding: 10px;
    }

    .card-header h2 {
        font-size: 1.8rem;
    }

    .custom-btn {
        background-color: #0b7b82 !important;
        color: white !important;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-size: 16px;
        text-decoration: none;
        transition: background 0.3s ease, transform 0.2s ease;
        box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
    }

    .filter-form {
        margin-top: 30px;
    }
</style>

<div style="text-align: center; margin-bottom: 20px;">
    <a href="@Url.Action("PerfilMED", "Perfil")" class="custom-btn">
        <i class="fas fa-home"></i> Inicio
    </a>
</div>

<div class="container" style="margin-top: 50px;">
    <div class="card shadow-lg" style="border-radius: 15px;">
        <div class="card-header text-center" style="background-color: #0b7b82; color: white; border-radius: 15px 15px 0 0;">
            <h2>Historial de Citas</h2>
        </div>
        <div class="card-body">
            <div class="filter-form">
                <form id="filterForm">
                    <div class="row">
                      
                        <div class="col-md-4">
                            <label for="tipoConsulta">Tipo de Consulta:</label>
                            <select class="form-control" id="tipoConsulta" name="tipoConsulta">
                                <option value="">Seleccione</option>
                                <option value="virtual">Virtual</option>
                                <option value="Presencial">Presencial</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn mt-3" style="background-color: #3bb4bc; color: white; border: none;">Aplicar Filtro</button>
                </form>
            </div>
            <br />
            <table class="table table-bordered table-striped table-hover" id="citasTable">
                <thead>
                    <tr>
                        <th>@Html.DisplayNameFor(model => model.Medico.Nombre)</th>
                        <th>@Html.DisplayNameFor(model => model.Nombre_Paciente)</th>
                        <th>@Html.DisplayNameFor(model => model.Estado_Asistencia)</th>
                        <th>@Html.DisplayNameFor(model => model.Hora_cita)</th>
                        <th>@Html.DisplayNameFor(model => model.Descripcion_Complicaciones)</th>
                        <th>@Html.DisplayNameFor(model => model.Sintomas)</th>
                        <th>@Html.DisplayNameFor(model => model.Fecha_Cita)</th>
                        <th>@Html.DisplayNameFor(model => model.Modalidad)</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@Html.DisplayFor(modelItem => item.Medico.Nombre)</td>
                            <td>@Html.DisplayFor(modelItem => item.Nombre_Paciente)</td>
                            <td>@Html.DisplayFor(modelItem => item.Estado_Asistencia)</td>
                            <td>@Html.DisplayFor(modelItem => item.Hora_cita)</td>
                            <td>@Html.DisplayFor(modelItem => item.Descripcion_Complicaciones)</td>
                            <td>@Html.DisplayFor(modelItem => item.Sintomas)</td>
                            <td>@Html.DisplayFor(modelItem => item.Fecha_Cita)</td>
                            <td>@Html.DisplayFor(modelItem => item.Modalidad)</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<br />

<div style="text-align: center; margin-bottom: 20px;">
    <a href="@Url.Action("NotasAdicionales", "Perfil")" class="custom-btn">
        <i class=""></i> Notas Adicionales
    </a>
</div>

<script>

$(document).ready(function () {
    $('#filterForm').submit(function (e) {
        e.preventDefault();

        var tipoConsulta = $('#tipoConsulta').val();

        $('#citasTable tbody').html('<tr><td colspan="8" class="text-center">Cargando...</td></tr>');

        $.ajax({
            url: '@Url.Action("FiltrarCitas", "Perfil")',
            type: 'GET',
            data: {
                tipoConsulta: tipoConsulta
            },
            success: function (data) {
                $('#citasTable tbody').empty();

                if (data && data.length > 0) {
                    data.forEach(function(item) {
                        var row = $('<tr>');
                        row.append('<td>' + (item.NombreMedico || '') + '</td>');
                        row.append('<td>' + (item.Nombre_Paciente || '') + '</td>');
                        row.append('<td>' + (item.Estado_Asistencia || '') + '</td>');
                        row.append('<td>' + (item.Hora_cita || '') + '</td>');
                        row.append('<td>' + (item.Descripcion_Complicaciones || '') + '</td>');
                        row.append('<td>' + (item.Sintomas || '') + '</td>');
                        row.append('<td>' + (item.Fecha_Cita || '') + '</td>');
                        row.append('<td>' + (item.Modalidad || '') + '</td>');
                        $('#citasTable tbody').append(row);
                    });
                } else {
                    $('#citasTable tbody').append('<tr><td colspan="8" class="text-center">No se encontraron citas.</td></tr>');
                }
            },
            error: function (xhr, status, error) {
                $('#citasTable tbody').html('<tr><td colspan="8" class="text-center text-danger">Error al cargar las citas: ' + error + '</td></tr>');
                console.log(xhr.responseText);
            }
        });
    });
});

</script>
