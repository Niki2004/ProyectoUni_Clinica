@model ProyectoClinica.Models.Factura

@{
    var serviciosSeleccionados = ViewBag.ServiciosSeleccionados as List<ProyectoClinica.Models.Servicio>;
}

<div class="container mt-5">
    <h2 class="text-center">Detalles del Pago</h2>

    <form id="detallesPagoForm" action="@Url.Action("GenerarFactura", "Factura")" method="post">
        @Html.AntiForgeryToken()

        <!-- Campos ocultos -->
        <input type="hidden" name="serviciosSeleccionados" value="@string.Join(",", serviciosSeleccionados.Select(s => s.Id_Servicio))" />
        <input type="hidden" name="total" value="@ViewBag.Total" />
        <input type="hidden" name="impuesto" value="@ViewBag.Impuesto" />



        <!-- Información del Cliente -->
        <div class="card shadow-sm p-4 mb-3">
            <h4>Información del Cliente</h4>
            <div class="form-group">
                <label for="cedulaCliente">Cédula del Cliente:</label>
                <input type="text" class="form-control" id="cedulaCliente" name="cedulaCliente" required />
            </div>
            <div class="form-group">
                <label for="nombreCliente">Nombre del Cliente:</label>
                <input type="text" class="form-control" id="nombreCliente" name="nombreCliente" required />
            </div>
        </div>

        <!-- Servicios Seleccionados -->
        <div class="card shadow-sm p-4 mb-3">
            <h4>Servicios Seleccionados</h4>
            <ul>
                @foreach (var servicio in ViewBag.ServiciosSeleccionados)
                {
                    <li><strong>@servicio.Nombre_Servicio</strong> - ₡@servicio.Precio_Servicio.ToString("N2")</li>
                }
            </ul>
        </div>

        <!-- Métodos de Pago -->
        <div class="card shadow-sm p-4 mb-3">
            <h4>Métodos de Pago</h4>
            @foreach (var metodo in ViewBag.MetodosPago)
            {
                <div class="form-check">
                    <input type="checkbox" class="form-check-input metodo-pago-checkbox"
                           id="Metodo_@metodo.Id_MetodoPago"
                           name="pagosPorMetodo[@metodo.Id_MetodoPago]" />
                    <label class="form-check-label" for="Metodo_@metodo.Id_MetodoPago">@metodo.Nombre</label>
                </div>
                <div class="form-group mt-2" id="MontoGroup_@metodo.Id_MetodoPago" style="display:none;">
                    <label for="Pago_@metodo.Id_MetodoPago">Monto para @metodo.Nombre:</label>
                    <input type="number" step="0.01"
                           name="pagosPorMetodo[@metodo.Id_MetodoPago]"
                           id="Pago_@metodo.Id_MetodoPago"
                           class="form-control"
                           disabled />
                </div>
            }
        </div>

        <!-- Resumen -->
        <div class="card shadow-sm p-4 mb-3">
            <h4>Resumen</h4>
            <p>Subtotal: <strong>₡@ViewBag.Subtotal</strong></p>
            <p>Impuesto (13%): <strong>₡@ViewBag.Impuesto</strong></p>
            <h5>Total a Pagar: <strong>₡@ViewBag.Total</strong></h5>
        </div>

        <!-- Botón de envío -->
        <button type="submit" class="btn btn-success w-100 mt-4">Procesar Pago</button>
    </form>
</div>

<script>
    // Lógica para habilitar o deshabilitar los montos según los métodos seleccionados
    document.querySelectorAll('.metodo-pago-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', function () {
            const inputId = this.id.split('_')[1];
            const inputGroup = document.getElementById(`MontoGroup_${inputId}`);
            const input = document.getElementById(`Pago_${inputId}`);
            if (this.checked) {
                inputGroup.style.display = "block";
                input.disabled = false;
            } else {
                inputGroup.style.display = "none";
                input.disabled = true;
            }
        });
    });
</script>

<style>
    .card {
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
    }

    .btn {
        border-radius: 8px;
        padding: 12px;
    }

    .form-control {
        border-radius: 8px;
        padding: 10px;
    }

    .text-center {
        font-family: Arial, sans-serif;
        color: #333;
    }

    .form-check {
        margin-bottom: 10px;
    }

    .form-check-input {
        margin-right: 10px;
    }
</style>
