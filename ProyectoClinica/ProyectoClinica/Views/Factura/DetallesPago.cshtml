@model ProyectoClinica.Models.Factura

@{
    var serviciosSeleccionados = ViewBag.ServiciosSeleccionados as List<ProyectoClinica.Models.Servicio>;
}

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.querySelector("form");
        const metodosPagoCheckboxes = document.querySelectorAll("input[name='MetodosPagoSeleccionados']");

        form.addEventListener("submit", function (event) {
            let seleccionado = false;

            // Recorre todos los checkboxes para verificar si hay al menos uno seleccionado
            metodosPagoCheckboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    seleccionado = true;
                }
            });

            if (!seleccionado) {
                event.preventDefault(); // Evita el envío del formulario
                alert("Debe seleccionar al menos un método de pago antes de confirmar.");
            }
        });
    });
</script>



<div class="container mt-5">
    <h2 class="text-center">Detalles del Pago</h2>

    <form id="detallesPagoForm" action="/Factura/GenerarFactura" method="post">
        @Html.AntiForgeryToken()

        <!-- Campos ocultos -->

        <input type="hidden" name="total" value="@ViewBag.Total" />
        <input type="hidden" name="impuesto" value="@ViewBag.Impuesto" />



        <!-- Información del Cliente -->
        <div class="card shadow-sm p-4 mb-3">
            <h4>Información del Cliente</h4>
            <div class="form-group">
                <label for="cedulaCliente">Cédula del Cliente:</label>
                <input type="text" class="form-control" id="cedulaCliente" name="cedulaCliente" required />
            </div>
            <div class="form-group">
                <label for="nombreCliente">Nombre del Cliente:</label>
                <input type="text" class="form-control" id="nombreCliente" name="nombreCliente" required />
            </div>
        </div>

        <!-- Servicios Seleccionados -->
        <div class="card shadow-sm p-4 mb-3">
            <h4>Servicios Seleccionados</h4>
            <ul>
                @foreach (var servicio in ViewBag.ServiciosSeleccionados)
                {
                    <li><strong>@servicio.Nombre_Servicio</strong> - ₡@servicio.Precio_Servicio.ToString("N2")</li>
                }
            </ul>
        </div>

        @if (ViewBag.ServiciosSeleccionados != null)
        {
            foreach (var servicio in serviciosSeleccionados)
            {
                <input type="hidden" name="serviciosSeleccionados" value="@servicio.Id_Servicio" />
            }
        }
        else
        {
            <p class="text-danger">No se seleccionaron servicios válidos.</p>
        }


        <!-- Métodos de Pago -->
        <div class="card shadow-sm p-4 mb-3">
            <h4>Métodos de Pago</h4>
            @foreach (var metodo in ViewBag.MetodosPago as List<ProyectoClinica.Models.Metodo_Pago>)
            {
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="MetodosPagoSeleccionados" value="@metodo.Id_MetodoPago" id="metodo_@metodo.Id_MetodoPago">
                    <label class="form-check-label" for="metodo_@metodo.Id_MetodoPago">@metodo.Nombre</label>
                </div>
            }
        </div>


        <!-- Resumen -->
        <div class="card shadow-sm p-4 mb-3">
            <h4>Resumen</h4>
            <p>Subtotal: <strong>₡@ViewBag.Subtotal.ToString("N2")</strong></p>
            <p>Impuesto (13%): <strong>₡@ViewBag.Impuesto.ToString("N2")</strong></p>
            <h5>Total a Pagar: <strong>₡@ViewBag.Total.ToString("N2")</strong></h5>
        </div>

        <!-- Botón de envío -->
        <button type="submit" class="btn btn-success w-100 mt-4">Procesar Pago</button>
    </form>
</div>


<style>
    .card {
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
    }

    .btn {
        border-radius: 8px;
        padding: 12px;
    }

    .form-control {
        border-radius: 8px;
        padding: 10px;
    }

    .text-center {
        font-family: Arial, sans-serif;
        color: #333;
    }

    .form-check {
        margin-bottom: 10px;
    }

    .form-check-input {
        margin-right: 10px;
    }
</style>
