@{
    ViewBag.Title = "Detalles del Pago";
    var servicios = ViewBag.ServiciosSeleccionados as IEnumerable<ProyectoClinica.Models.Servicio>;
    var pagosPorMetodo = ViewBag.PagosPorMetodo as Dictionary<string, decimal>;
    var metodosSeleccionados = ViewBag.MetodosPagoSeleccionados as string[];
}

<div class="container mt-5">
    <h2 class="text-center">Detalles del Pago</h2>

    <!-- Detalles de los Servicios -->
    <div class="card shadow-sm p-4 mb-3">
        <h4>Servicios Seleccionados</h4>
        <ul>
            @foreach (var servicio in servicios)
            {
                <li>
                    <strong>@servicio.Nombre_Servicio</strong> - $@servicio.Precio_Servicio
                </li>
            }
        </ul>
    </div>

    <!-- Selección del Método de Pago -->
    <div class="card shadow-sm p-4 mb-3">
        <h4>Métodos de Pago</h4>
        <form action="/Factura/DetallesPago" method="post">
            @Html.AntiForgeryToken()
            <input type="hidden" name="serviciosSeleccionados" value="@string.Join(",", servicios.Select(s => s.Id_Servicio))" />
            <div class="form-group">
                @foreach (var metodo in ViewBag.MetodosPago as string[])
                {
                    <div class="form-check">
                        <input type="checkbox" name="metodosPago" value="@metodo" id="@metodo" class="form-check-input"
                               @(metodosSeleccionados != null && metodosSeleccionados.Contains(metodo) ? "checked" : "") />
                        <label for="@metodo" class="form-check-label">@metodo</label>
                    </div>
                }
            </div>
            <button type="submit" class="btn btn-block mt-4" style="background-color: #0b7b82; color: white;">Actualizar Métodos de Pago</button>
        </form>
    </div>

    <!-- Inputs para los Métodos de Pago Seleccionados -->
    @if (metodosSeleccionados != null && metodosSeleccionados.Length > 1)
    {
        <div class="card shadow-sm p-4 mb-3">
            <h4>Ingrese los montos para cada método de pago</h4>
            <form action="/Factura/DetallesPago" method="post">
                @Html.AntiForgeryToken()
                <input type="hidden" name="serviciosSeleccionados" value="@string.Join(",", servicios.Select(s => s.Id_Servicio))" />
                <input type="hidden" name="metodosPago" value="@string.Join(",", metodosSeleccionados)" />

                @foreach (var metodo in metodosSeleccionados)
                {
                    <div class="form-group">
                        <label for="Pago_@metodo">Monto para @metodo:</label>
                        <input type="number" step="0.01" name="pagosPorMetodo[@metodo]" id="Pago_@metodo" class="form-control"
                               value="@(pagosPorMetodo != null && pagosPorMetodo.ContainsKey(metodo) ? pagosPorMetodo[metodo] : 0)">
                    </div>
                }

            
            </form>
        </div>
    }

    <!-- Resumen -->
    <div class="card shadow-sm p-4 mb-3">
        <h4>Resumen</h4>
        <p>Subtotal: <strong>@ViewBag.Subtotal</strong></p>
        <p>Descuento: <strong>@ViewBag.Descuento ?? "₡0.00"</strong></p>
        <p>Impuesto (13%): <strong>@ViewBag.Impuesto</strong></p>
        <h5>Total a Pagar: <strong>@ViewBag.Total</strong></h5>
    </div>

    <button class="btn btn-block mt-4" style="background-color: #0b7b82; color: white;">Procesar Pago</button>
</div>

<style>
    .form-check {
        margin-bottom: 10px;
    }

    .form-check-input {
        margin-right: 10px;
    }

    .card {
        border-radius: 15px;
    }

    .btn {
        border-radius: 8px;
        padding: 10px 20px;
    }

    .form-control {
        border-radius: 8px;
        padding: 10px;
    }

    .text-center {
        font-family: Arial, sans-serif;
        color: #333;
    }
</style>
